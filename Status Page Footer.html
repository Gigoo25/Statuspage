<!DOCTYPE html>
<html>
	<script>
		// Text changes throughout the page
		//---------------------------------
			//Replace "Had a major outage" with "Had and outage" in Component Status
		$(function() {
			$(document).ready(function() {
				var str = document.getElementById("major-outage-group-count").innerHTML;
				var res = str.replace(" had a major outage", " had an outage");
				document.getElementById("major-outage-group-count").innerHTML = res;
			});
		});

			//Replace "Component Status" titles
		$('.component-status').each(function() {
			var text = $(this).text();
				//Replace "Major outage" with "Outage"
			$(this).text(text.replace('Major Outage', 'Outage'));
				//Replace "Partial Outage" with "Informational"
			$(this).text(text.replace('Partial Outage', 'Informational'));
				//Replace "Degraded Performance" with "Event"
			$(this).text(text.replace('Degraded Performance', 'Event'));
		});

		// Button Functionality
		//-----------------------------------
			//Fade arrow up button after scrolling down some
		$(window).scroll(function() {
			var height = $(window).scrollTop();
			if (height > 650) {
				$('#topBtn').fadeIn();
			} else {
				$('#topBtn').fadeOut();
			}
		});

			//Scroll to top when arrow up clicked
		function topFunction() {
			document.querySelector('#custom-header').scrollIntoView({
				behavior: 'smooth'
			});
		};

			//Move support button after shrinking/increasing the window width
		$(window).resize(function() {
				var wi = $(window).width();
				if (wi < 822) {
					$('#portalBtn').appendTo('#custom-header');
			}
		});

		// Unused components removal
		//--------------------------
			//Remove 90 day uptime link
		$('.components-uptime-link').remove();

		// Layout for components/page
		//---------------------------
			// Row Div creation - CUSTOM
		$row = $('<div class="row"></div>');
		$row.prependTo('.layout-content > .container');

			// Set variables
		var Informational = $('#Informational');
		var Informational_Container = $('#Informational_Container');
		var Open_Incidents = $('#Open_Incidents');
		var Open_Incidents_Container = $('#Open_Incidents_Container');

			//Adjust layout based on size of the window without blocking the ability to copy text
		function applyLayout(x) {
			// Correct color coding based on title
			ColorCorrect ();

			// Close components that are open
			ComponentClose ();

			// Place titles above containers
			Informational.prependTo($(Informational_Container));
			Open_Incidents.prependTo($(Open_Incidents_Container));

			// Place incidents into containers
			Open_Incidents_Container.appendTo($('.unresolved-incidents'));
			Informational_Container.appendTo($('.unresolved-incidents'));

			// Place incidents into containers
			$('.unresolved-incident.impact-major').appendTo($(Informational_Container));
			$('.unresolved-incident.impact-minor, .unresolved-incident.impact-none, .unresolved-incident.impact-maintenance, .unresolved-incident.impact-critical').appendTo($(Open_Incidents_Container));

			// Place scheduled maintenance container above past incidents
			$('.scheduled-maintenances-container').prependTo($('#past-incidents'));

			// Append "Past Incidents" to "Components section" to allow for uniform spacing
			$('#past-incidents').addClass('span4').appendTo($('.components-section'));

			// Append "Incident List" to "Components section" to allow past incidents to be on the left side
			$('.incidents-list.format-expanded').addClass('span4').appendTo($('.components-section'));

			// Show informational title/container if major incidents are present
			if($('.unresolved-incident.impact-major').length){
			  $('#Informational').show();
			  $('#Informational_Container').show();
			};

				// Run functions if none, minor & critical incidents are present
			if($('.unresolved-incident.impact-maintenance, .unresolved-incident.impact-minor, .unresolved-incident.impact-none, .unresolved-incident.impact-critical').length){
					// Show open incidents title/container
				$('#Open_Incidents').show();
				$('#Open_Incidents_Container').show();
					// Sort incidents by severity
				SortIncidents ();
			};

				// Remove subscribe button from incidents
			$('.layout-content.status.status-index .unresolved-incidents .unresolved-incident .incident-title .subscribe').remove();
			$('.flat-button, .subscribe-button').remove();

			if (x.matches) { // If media query matches
				// Format page layout
				$('.components-section').removeClass('span4').prependTo($row);
				$('.unresolved-incidents').removeClass('span8').prependTo($row);
				$('.page-status.status-none').removeClass('span8').prependTo($row);
				$('#portalBtn').removeClass('span8').prependTo($row);
				// Hide cover once page is fully loaded
				HideCover ();
		  } else {
				// Format page layout
				$('.components-section').addClass('span4').appendTo($row);
				$('.unresolved-incidents').addClass('span8').appendTo($row);
				$('.page-status.status-none').addClass('span8').appendTo($row);
				// Hide cover once page is fully loaded
				HideCover ();
		  }
		};

		var x = window.matchMedia("(max-width: 822px)")
		applyLayout(x) // Call listener function at run time
		x.addListener(applyLayout) // Attach listener function on state changes

			// Correct title color in the "incidents" page
		$( window ).on( "load", function() {
			if(location.pathname=="/incidents/") {
				ColorCorrect ();
			};
		});

		// Other Changes
		//---------------------------
			//Limit History
		  	//Replace "x" with the number of days you want to show + 2
		$(function() {
			$('.status-day:nth-child(n+4)').remove();
		});

			// Assign id to history expand incident buttons
		$(document).ready(function(){
			$('.expand-incidents').attr('id', 'button1');
		});

			// Call function when history expand incident buttons are clicked
		$(document).on('click', '#button1', function(event) {
			setTimeout(ColorCorrect, 200)
		});

		// Functions
		//---------------------------
			// Hide cover once page is fully loaded
		function HideCover () {
			 $("#cover").hide();
			 $(".spinner").hide();
		};

			// Correct color coding based on title
		function ColorCorrect () {
				// Correct color for open incidents
			$(".incident-title:contains('Outage')").closest(".unresolved-incident").removeClass().addClass( "unresolved-incident impact-critical" );
			$(".incident-title:contains('Informational')").closest(".unresolved-incident").removeClass().addClass( "unresolved-incident impact-major" );
			$(".incident-title:contains('Maintenance')").closest(".unresolved-incident").removeClass().addClass( "unresolved-incident impact-none" );
			$(".incident-title:contains('Event')").closest(".unresolved-incident").removeClass().addClass( "unresolved-incident impact-minor" );
				// Correct color for past incidents
			$(".incident-title:contains('Outage')").removeClass().addClass( "incident-title impact-critical font-large" );
			$(".incident-title:contains('Informational')").removeClass().addClass( "incident-title impact-major font-large" );
			$(".incident-title:contains('Maintenance')").removeClass().addClass( "incident-title impact-none font-large" );
			$(".incident-title:contains('Event')").removeClass().addClass( "incident-title impact-minor font-large" );
				// Correct color for single incidents
			$(".incident-name:contains('Outage')").removeClass().addClass( "color-primary incident-name impact-critical" );
			$(".incident-name:contains('Informational')").removeClass().addClass( "color-primary incident-name impact-major" );
			$(".incident-name:contains('Maintenance')").removeClass().addClass( "color-primary incident-name impact-maintenance" );
			$(".incident-name:contains('Event')").removeClass().addClass( "color-primary incident-name impact-minor" );
				//**Second pass**
					//Checking if the class does not exist
					//This is for titles that have multiple matching words like "Informational" & "Event"
					//This method is temporary until I can think of a more efficient way of writing this
			if ($('.unresolved-incident').hasClass("impact-critical") !== false) {
				$(".incident-title:contains('Outage')").closest(".unresolved-incident").removeClass().addClass( "unresolved-incident impact-critical" );
				$(".incident-title:contains('Outage')").removeClass().addClass( "incident-title impact-critical font-large" );
				$(".incident-name:contains('Outage')").removeClass().addClass( "color-primary incident-name impact-critical" );
			};
			if ($('.unresolved-incident').hasClass("impact-major") !== false) {
				$(".incident-title:contains('Informational')").closest(".unresolved-incident").removeClass().addClass( "unresolved-incident impact-major" );
				$(".incident-title:contains('Informational')").removeClass().addClass( "incident-title impact-major font-large" );
				$(".incident-name:contains('Informational')").removeClass().addClass( "color-primary incident-name impact-major" );
			};
			if ($('.unresolved-incident').hasClass("impact-none") !== false) {
				$(".incident-title:contains('Maintenance')").closest(".unresolved-incident").removeClass().addClass( "unresolved-incident impact-none" );
				$(".incident-title:contains('Maintenance')").removeClass().addClass( "incident-title impact-none font-large" );
				$(".incident-name:contains('Maintenance')").removeClass().addClass( "color-primary incident-name impact-maintenance" );
			};
			if ($('.unresolved-incident').hasClass("impact-minor") !== false) {
				$(".incident-title:contains('Event')").closest(".unresolved-incident").removeClass().addClass( "unresolved-incident impact-minor" );
				$(".incident-title:contains('Event')").removeClass().addClass( "incident-title impact-minor font-large" );
				$(".incident-name:contains('Event')").removeClass().addClass( "color-primary incident-name impact-minor" );
			};
		};

			// Close components that are open & change the minus square to a plus
		function ComponentClose () {
			$(".component-container, .border-color, .is-group").toggleClass("open",false);
			$(".group-parent-indicator").toggleClass("fa-plus-square-o",true);
			$(".group-parent-indicator").toggleClass("fa-minus-square-o",false);
		};

			// Close components that are open & change the minus square to a plus
		function SortIncidents () {
			var $OpenIncidentsList = $('#Open_Incidents_Container');

			// Elements one layer deep get .children(), any deeper go with .find()
			var $Incidents = $OpenIncidentsList.children('.unresolved-incident');

			/* Bind $incidents to the sort method so we don't have to travel up all these properties more than once.*/
			var sortList = Array.prototype.sort.bind($Incidents);

			sortList(function ( a, b ) {

			    // Cache inner content from the first element (a) and the next sibling (b)
			    var aText = a.innerHTML;
			    var bText = b.innerHTML;

			    // Returning -1 will place element `a` before element `b`
			    if ( aText < bText ) {
			        return -1;
			    }

			    // Returning 1 will do the opposite
			    if ( aText > bText ) {
			        return 1;
			    }

			    // Returning 0 leaves them as-is
			    return 0;
			});

			// Put it right back where we got it
			$OpenIncidentsList.append($Incidents);
		};

	</script>
</html>
